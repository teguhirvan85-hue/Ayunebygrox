<!doctype html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Spectro ‚Äì Trade (Single File)</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <style>
    /* extra: smoother look similar to screenshot */
    :root{
      --glass: rgba(255,255,255,.06);
      --glass2: rgba(255,255,255,.04);
      --border: rgba(255,255,255,.10);
      --border2: rgba(255,255,255,.14);
      --textDim: rgba(255,255,255,.55);
      --textDim2: rgba(255,255,255,.40);
      --shadowA: 0 30px 120px rgba(0,0,0,.60);
      --shadowB: 0 12px 40px rgba(0,0,0,.35);
    }
    .glass {
      background: var(--glass);
      border: 1px solid var(--border);
      box-shadow: var(--shadowB);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
    }
    .glass2 {
      background: var(--glass2);
      border: 1px solid var(--border);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
    }
    .soft-border { border: 1px solid var(--border); }
    .soft-border2 { border: 1px solid var(--border2); }
    .no-select { user-select: none; }
    /* range look */
    input[type="range"] { accent-color: #22c55e; }
  </style>
</head>

<body class="min-h-screen w-full text-white bg-gradient-to-b from-[#1a1a1d] via-[#121214] to-[#0b0b0d]">
  <div class="mx-auto max-w-[1320px] px-5 pt-6">
    <div class="rounded-3xl soft-border bg-black/40" style="box-shadow: var(--shadowA);">

      <!-- Top window chrome -->
      <div class="flex items-center justify-between px-5 py-4">
        <div class="flex items-center gap-3">
          <div class="flex items-center gap-2">
            <div class="h-3 w-3 rounded-full bg-red-500/90"></div>
            <div class="h-3 w-3 rounded-full bg-yellow-400/90"></div>
            <div class="h-3 w-3 rounded-full bg-green-500/90"></div>
          </div>

          <div class="ml-3 flex items-center gap-2">
            <button class="rounded-lg p-2 text-white/70 hover:bg-white/5 hover:text-white" title="Back">‚Üê</button>
            <button class="rounded-lg p-2 text-white/70 hover:bg-white/5 hover:text-white" title="Forward">‚Üí</button>
          </div>
        </div>

        <div class="hidden w-[520px] md:flex items-center justify-center">
          <div class="w-full rounded-2xl soft-border bg-white/5 px-4 py-2 text-center text-sm text-white/70">
            https://www.dashboard/trade.com
          </div>
        </div>

        <div class="flex items-center gap-2">
          <button class="rounded-xl p-2 text-white/70 hover:bg-white/5 hover:text-white" title="Download">‚§ì</button>
          <button class="rounded-xl p-2 text-white/70 hover:bg-white/5 hover:text-white" title="Minimize">‚ñ≠</button>
          <button class="rounded-xl p-2 text-white/70 hover:bg-white/5 hover:text-white" title="New Tab">Ôºã</button>
        </div>
      </div>

      <!-- App header -->
      <div class="flex flex-col gap-4 px-5 pb-5">
        <div class="flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between">
          <div class="flex items-center gap-4">
            <div class="flex items-center gap-3">
              <div class="grid h-10 w-10 place-items-center rounded-2xl bg-white/5">
                <div class="h-6 w-6 rotate-12 rounded-md bg-white/90"></div>
              </div>
              <div class="text-xl font-semibold tracking-tight">Spectro</div>
            </div>

            <!-- Nav -->
            <div id="nav" class="flex items-center gap-1 rounded-2xl soft-border bg-white/5 p-1">
              <!-- injected -->
            </div>
          </div>

          <!-- Search + icons -->
          <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between lg:justify-end">
            <div class="relative w-full sm:w-[420px]">
              <div class="pointer-events-none absolute left-4 top-1/2 -translate-y-1/2 text-white/40">üîé</div>
              <input id="search"
                placeholder="Search..."
                class="h-11 w-full rounded-2xl soft-border bg-white/5 pl-11 pr-4 text-sm text-white placeholder:text-white/35 outline-none focus:border-white/20"
              />
            </div>

            <div class="flex items-center gap-2">
              <button class="rounded-2xl soft-border bg-white/5 p-2 text-white/70 hover:bg-white/10 hover:text-white" title="Language">üåê</button>
              <button class="rounded-2xl soft-border bg-white/5 p-2 text-white/70 hover:bg-white/10 hover:text-white" title="Notifications">üîî</button>
              <button class="rounded-2xl soft-border bg-white/5 p-2 text-white/70 hover:bg-white/10 hover:text-white" title="Account">üë§</button>
            </div>
          </div>
        </div>

        <!-- Asset row -->
        <div id="assetRow" class="grid grid-cols-1 gap-3 md:grid-cols-4">
          <!-- injected -->
        </div>
      </div>

      <!-- Main content -->
      <div class="grid grid-cols-1 gap-4 px-5 pb-6 lg:grid-cols-[1.6fr_0.9fr]">

        <!-- Chart Card -->
        <div id="chartCard" class="glass rounded-2xl p-4">
          <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
            <div class="flex items-center gap-3">
              <div class="flex items-center gap-2">
                <div id="assetIcon" class="grid h-9 w-9 place-items-center rounded-2xl text-sm font-semibold bg-orange-500">‚Çø</div>
                <button id="assetSwitch"
                  class="flex items-center gap-2 rounded-xl px-2 py-1 text-sm font-semibold text-white/90 hover:bg-white/5"
                  title="Switch asset"
                >
                  <span id="assetName">Bitcoin</span>
                  <span class="text-white/45">‚ñæ</span>
                </button>
              </div>

              <div id="tfRow" class="hidden md:flex items-center gap-2"></div>
            </div>

            <div class="flex items-center justify-between gap-2 md:justify-end">
              <div class="flex items-center gap-1 rounded-2xl soft-border bg-white/5 p-1">
                <button id="modeLine" class="rounded-xl p-2 bg-white/10 text-white" title="Line/Area">üìà</button>
                <button id="modeCandle" class="rounded-xl p-2 text-white/60 hover:bg-white/5 hover:text-white" title="Candlestick (visual)">üïØÔ∏è</button>
              </div>

              <button id="chartFocus" class="rounded-2xl soft-border bg-white/5 p-2 text-white/70 hover:bg-white/10 hover:text-white" title="Focus">
                ‚õ∂
              </button>

              <button id="quoteBtn" class="rounded-2xl soft-border bg-white/5 px-3 py-2 text-xs text-white/70 hover:bg-white/10 hover:text-white" title="Toggle quote">USD</button>
            </div>
          </div>

          <div class="mt-3 grid grid-cols-[44px_1fr] gap-3">
            <!-- Left tool rail -->
            <div class="flex flex-col items-center gap-2">
              <button class="grid h-10 w-10 place-items-center rounded-2xl soft-border bg-white/5 text-white/60 hover:bg-white/10 hover:text-white" title="Compass">üß≠</button>
              <button class="grid h-10 w-10 place-items-center rounded-2xl soft-border bg-white/5 text-white/60 hover:bg-white/10 hover:text-white" title="Chart">üìä</button>
              <button class="grid h-10 w-10 place-items-center rounded-2xl soft-border bg-white/5 text-white/60 hover:bg-white/10 hover:text-white" title="Sliders">üéöÔ∏è</button>
              <button class="grid h-10 w-10 place-items-center rounded-2xl soft-border bg-white/5 text-white/60 hover:bg-white/10 hover:text-white" title="Candles">üïØÔ∏è</button>
              <button class="grid h-10 w-10 place-items-center rounded-2xl soft-border bg-white/5 text-white/60 hover:bg-white/10 hover:text-white" title="Settings">‚öôÔ∏è</button>
              <div class="mt-2 h-px w-8 bg-white/10"></div>
              <button class="grid h-10 w-10 place-items-center rounded-2xl soft-border bg-white/5 text-white/60 hover:bg-white/10 hover:text-white" title="Text">T</button>
            </div>

            <!-- Chart surface -->
            <div class="rounded-2xl soft-border bg-black/20 p-3">
              <div class="h-[320px] w-full">
                <canvas id="chart"></canvas>
              </div>

              <div class="mt-2 flex items-center justify-between text-xs text-white/45">
                <div class="flex items-center gap-2">
                  <span id="chartBadge" class="rounded-lg soft-border bg-white/5 px-2 py-1">Area</span>
                  <span>‚Ä¢</span>
                  <span id="pairBadge">BTC/USD</span>
                </div>
                <div class="text-white/35">$100.00 ‚Äî $150.00</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Order panel -->
        <div class="glass rounded-2xl p-4">
          <div class="flex items-center justify-between">
            <div id="orderTabs" class="flex items-center gap-1 rounded-2xl soft-border bg-white/5 p-1"></div>
            <button id="quickToolsBtn" class="rounded-2xl soft-border bg-white/5 p-2 text-white/70 hover:bg-white/10 hover:text-white" title="Quick tools">üéöÔ∏è</button>
          </div>

          <div class="mt-4 space-y-3">
            <div class="flex items-center justify-between text-sm text-white/70">
              <div>Available to Trade :</div>
              <div id="availableLabel" class="text-white/45">‚Äî</div>
            </div>

            <div class="flex items-center justify-between text-sm text-white/70">
              <div>Position:</div>
              <div class="text-white/45">‚Äî</div>
            </div>

            <div class="rounded-2xl soft-border bg-white/5 p-3">
              <div class="flex items-center justify-between">
                <div class="text-xs text-white/60">Amount</div>
                <div class="flex items-center gap-2 text-xs text-white/60">
                  <span id="amountLabel">0.00000</span>
                  <span id="amountAsset" class="rounded-lg soft-border bg-white/5 px-2 py-1">BTC</span>
                  <span class="text-white/45">‚ñæ</span>
                </div>
              </div>

              <div class="mt-3">
                <input id="amountRange" type="range" min="0" max="100" value="20" class="w-full">
                <div class="mt-2 flex items-center justify-between text-xs text-white/45">
                  <div id="pctPill" class="rounded-lg soft-border bg-white/5 px-2 py-1">20%</div>
                  <div>20 %</div>
                </div>
              </div>
            </div>

            <div class="grid grid-cols-2 gap-3">
              <button id="buyBtn" class="h-11 rounded-2xl font-semibold transition bg-white/10 text-white/40 cursor-not-allowed">Buy/Long</button>
              <button id="sellBtn" class="h-11 rounded-2xl font-semibold transition bg-white/10 text-white/40 cursor-not-allowed">Sell/Short</button>
            </div>

            <div class="space-y-2 text-sm text-white/70">
              <label class="flex items-center gap-2 no-select">
                <input id="reduceOnly" type="checkbox" class="h-4 w-4 rounded border-white/15 bg-white/5 accent-emerald-500" />
                <span>Reduce Only</span>
              </label>
              <label class="flex items-center gap-2 no-select">
                <input id="tpsl" type="checkbox" class="h-4 w-4 rounded border-white/15 bg-white/5 accent-emerald-500" />
                <span>Take Profit / Stop Loss</span>
              </label>
            </div>

            <button id="walletBtn" class="mt-1 flex h-11 w-full items-center justify-center gap-2 rounded-2xl font-semibold transition bg-emerald-500/90 text-black hover:bg-emerald-400">
              <span>üëõ</span>
              <span id="walletBtnText">Connect Wallet to Trade</span>
            </button>

            <div class="mt-4 space-y-2 text-sm">
              <div class="flex items-center justify-between">
                <div class="text-white/55">Order Value:</div>
                <div id="orderValue" class="text-white/75">‚Äî</div>
              </div>
              <div class="flex items-center justify-between">
                <div class="text-white/55">Est. Liq. Price:</div>
                <div class="text-white/75">‚Äî</div>
              </div>
              <div class="flex items-center justify-between">
                <div class="text-white/55">Position Margin:</div>
                <div class="text-white/75">$0.00</div>
              </div>
              <div class="flex items-center justify-between">
                <div class="text-white/55">Est. Price:</div>
                <div id="estPrice" class="text-white/75">‚Äî</div>
              </div>
              <div class="flex items-center justify-between">
                <div class="text-white/55">Slippage:</div>
                <div id="slippage" class="text-emerald-400">‚Äî</div>
              </div>
              <div class="flex items-center justify-between">
                <div class="text-white/55">Fees:</div>
                <div id="fees" class="text-white/75">‚Äî</div>
              </div>
            </div>

            <!-- Quick tools panel -->
            <div id="quickToolsPanel" class="hidden rounded-2xl soft-border bg-black/30 p-3 text-sm text-white/70">
              <div class="flex items-center justify-between">
                <div class="font-semibold text-white">Quick tools</div>
                <button id="quickToolsClose" class="rounded-xl px-2 py-1 text-white/60 hover:bg-white/5 hover:text-white">Close</button>
              </div>
              <div class="mt-2 grid grid-cols-2 gap-2">
                <button data-setpct="25" class="qtBtn rounded-xl soft-border bg-white/5 px-3 py-2 text-left hover:bg-white/10">Set 25%</button>
                <button data-setpct="50" class="qtBtn rounded-xl soft-border bg-white/5 px-3 py-2 text-left hover:bg-white/10">Set 50%</button>
                <button data-setpct="75" class="qtBtn rounded-xl soft-border bg-white/5 px-3 py-2 text-left hover:bg-white/10">Set 75%</button>
                <button data-setpct="100" class="qtBtn rounded-xl soft-border bg-white/5 px-3 py-2 text-left hover:bg-white/10">Set 100%</button>
              </div>
            </div>

          </div>
        </div>

        <!-- Bottom table -->
        <div id="bottomCard" class="glass rounded-2xl p-4">
          <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
            <div id="bottomTabs" class="flex items-center gap-1 rounded-2xl soft-border bg-white/5 p-1"></div>

            <div class="flex items-center gap-2">
              <button id="bottomFilterBtn" class="flex items-center gap-2 rounded-2xl soft-border bg-white/5 px-3 py-2 text-sm text-white/70 hover:bg-white/10 hover:text-white">
                üéöÔ∏è Filter
              </button>
              <button id="viewSettingsBtn" class="flex items-center gap-2 rounded-2xl soft-border bg-white/5 px-3 py-2 text-sm text-white/70 hover:bg-white/10 hover:text-white">
                ‚öôÔ∏è View Settings
              </button>
            </div>
          </div>

          <div class="mt-4 overflow-hidden rounded-2xl soft-border">
            <table class="w-full">
              <thead class="bg-white/5">
                <tr class="text-left text-xs text-white/55">
                  <th class="px-4 py-3 font-medium">Date</th>
                  <th class="px-4 py-3 font-medium">Type</th>
                  <th class="px-4 py-3 font-medium">Price</th>
                  <th class="px-4 py-3 font-medium">USD</th>
                  <th class="px-4 py-3 font-medium">ZEC</th>
                  <th class="px-4 py-3 font-medium">PAIR</th>
                  <th class="px-4 py-3 font-medium">TRADER</th>
                </tr>
              </thead>
              <tbody id="txBody" class="bg-black/20"></tbody>
            </table>
          </div>

          <div id="viewSettingsPanel" class="hidden mt-3 rounded-2xl soft-border bg-black/30 p-3 text-sm text-white/70">
            <div class="flex items-center justify-between">
              <div class="font-semibold text-white">View settings</div>
              <button id="viewSettingsClose" class="rounded-xl px-2 py-1 text-white/60 hover:bg-white/5 hover:text-white">Close</button>
            </div>
            <div class="mt-2 grid grid-cols-1 gap-2 sm:grid-cols-2">
              <button id="toggleChartMode" class="rounded-xl soft-border bg-white/5 px-3 py-2 text-left hover:bg-white/10">Toggle chart mode</button>
              <button id="toggleQuote" class="rounded-xl soft-border bg-white/5 px-3 py-2 text-left hover:bg-white/10">Toggle quote</button>
            </div>
          </div>
        </div>

        <!-- Market trades -->
        <div class="glass rounded-2xl p-4">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-1 rounded-2xl soft-border bg-white/5 p-1">
              <button class="h-9 rounded-xl px-4 text-sm font-semibold bg-white/10 text-white">Market Trades</button>
              <button class="h-9 rounded-xl px-4 text-sm font-semibold text-white/60 hover:bg-white/5 hover:text-white">My Trades</button>
            </div>
            <button class="rounded-2xl soft-border bg-white/5 p-2 text-white/60 hover:bg-white/10 hover:text-white">Ôºã</button>
          </div>

          <div class="mt-4 overflow-hidden rounded-2xl soft-border">
            <div class="grid grid-cols-3 bg-white/5 px-4 py-3 text-xs text-white/55">
              <div>Price (USDT)</div>
              <div class="text-center">Amount (BTC)</div>
              <div class="text-right">Time</div>
            </div>
            <div id="marketTrades" class="divide-y divide-white/10 bg-black/20"></div>
          </div>

          <div class="mt-3 text-xs text-white/45">
            Click assets above to switch context. Connect wallet to enable trading.
          </div>
        </div>

      </div>

      <div class="h-4"></div>
    </div>
  </div>

  <div class="pb-10"></div>

  <script>
    // ---------- State ----------
    const state = {
      nav: "Trade",
      quote: "USD",
      selectedAsset: "BTC",
      timeframe: "1m",
      chartMode: "line", // line | candle (visual)
      focus: false,

      orderTab: "Market",
      amountPct: 20,
      walletConnected: false,

      bottomTab: "Transaction",
    };

    const assets = [
      { key:"BTC", name:"Bitcoin", icon:"‚Çø", iconBg:"bg-orange-500", amount:17.61, sub:"$1,165,173.69", priceLine:"1 BTC = $65,173.69", estPrice: 95861.89 },
      { key:"NEAR", name:"Near", icon:"N",  iconBg:"bg-slate-800",  amount:8.60,  sub:"$2,105,103.09", priceLine:"1 NEAR = $6.24",      estPrice: 6.24 },
      { key:"ADA", name:"Cardano", icon:"A", iconBg:"bg-blue-600",   amount:10.60, sub:"$3,150,145.60", priceLine:"1 ADA = $0.61",       estPrice: 0.61 },
      { key:"AAVE",name:"Aave",    icon:"A", iconBg:"bg-indigo-600", amount:17.61, sub:"$1,100,153.69", priceLine:"1 AAVE = $98.43",     estPrice: 98.43 },
    ];

    const navItems = ["Dashboard","Trade","Market","Earn","More"];
    const timeframes = ["1s","1m","5m","15m","1h","4h","D"];
    const orderTabs = ["Market","Limit","Advance"];
    const bottomTabs = ["Transaction","Active DCAs","Holders","Bubblemap","Top Trades"];

    const txRows = [
      { date:"24 Jan", type:"Sell", price:694.4680, usd:2.29,   zec:3.02, pair:"2.10K USDC", trader:"Binance" },
      { date:"20 Feb", type:"Buy",  price:694.4680, usd:0.79,   zec:0.00, pair:"0.79 USDC",  trader:"Router"  },
      { date:"15 Mar", type:"Sell", price:694.4680, usd:149.87, zec:0.22, pair:"149.88 USDC",trader:"Bybit"   },
    ];

    const marketTradesData = [
      { p: 95861.89, a: 0.00079, t: "14:30:33", s: "sell" },
      { p: 95860.12, a: 0.00112, t: "14:30:21", s: "buy"  },
      { p: 95858.44, a: 0.00051, t: "14:30:09", s: "sell" },
      { p: 95857.77, a: 0.00208, t: "14:29:58", s: "buy"  },
    ];

    // ---------- Helpers ----------
    function $(id){ return document.getElementById(id); }
    function fmt(n, d=2){
      return Number(n).toLocaleString(undefined, { maximumFractionDigits:d, minimumFractionDigits:d });
    }
    function asset(){
      return assets.find(a => a.key === state.selectedAsset) || assets[0];
    }
    function compute(){
      const available = state.walletConnected ? 0.07980 : 0;
      const amt = state.walletConnected ? +(available * state.amountPct / 100).toFixed(5) : 0;
      const estPrice = asset().estPrice;
      const orderValue = +(amt * estPrice).toFixed(2);
      return { available, amt, estPrice, orderValue };
    }

    // ---------- Render: Nav ----------
    function renderNav(){
      const nav = $("nav");
      nav.innerHTML = navItems.map(item => {
        const active = item === state.nav;
        return `
          <button data-nav="${item}"
            class="rounded-xl px-4 py-2 text-sm font-medium transition ${active ? "bg-white/10 text-white" : "text-white/60 hover:bg-white/5 hover:text-white"}">
            ${item}
          </button>
        `;
      }).join("");
      nav.querySelectorAll("button[data-nav]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          state.nav = btn.dataset.nav;
          renderNav();
        });
      });
    }

    // ---------- Render: Assets ----------
    function renderAssets(){
      const row = $("assetRow");
      row.innerHTML = assets.map(a=>{
        const active = a.key === state.selectedAsset;
        return `
          <button data-asset="${a.key}" class="text-left">
            <div class="glass rounded-2xl p-4 transition ${active ? "soft-border2 bg-white/[0.07]" : "hover:border-white/15 hover:bg-white/[0.06]"}">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <div class="grid h-9 w-9 place-items-center rounded-2xl text-sm font-semibold ${a.iconBg}">${a.icon}</div>
                  <div>
                    <div class="text-sm font-semibold">${a.name}</div>
                    <div class="text-xs text-white/45">${String(a.amount).replace(".", ",")} ${a.key}</div>
                    <div class="text-xs text-white/35">${a.sub}</div>
                  </div>
                </div>
                <div class="flex items-center gap-2">
                  <div class="rounded-xl soft-border bg-white/5 px-2 py-1 text-xs text-white/70">${state.quote}</div>
                  <div class="text-white/45">‚ñæ</div>
                </div>
              </div>
              <div class="mt-3 text-xs text-emerald-400/90">${a.priceLine}</div>
            </div>
          </button>
        `;
      }).join("");

      row.querySelectorAll("button[data-asset]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          state.selectedAsset = btn.dataset.asset;
          renderAssets();
          syncAssetHeader();
          syncOrderPanel();
          syncBottom();
        });
      });
    }

    // ---------- Render: Timeframes ----------
    function renderTimeframes(){
      const tf = $("tfRow");
      tf.innerHTML = timeframes.map(t=>{
        const active = t === state.timeframe;
        return `
          <button data-tf="${t}" class="rounded-xl px-3 py-1.5 text-xs font-medium transition ${active ? "bg-white/10 text-white" : "bg-transparent text-white/60 hover:bg-white/5 hover:text-white"}">
            ${t}
          </button>
        `;
      }).join("");
      tf.querySelectorAll("button[data-tf]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          state.timeframe = btn.dataset.tf;
          renderTimeframes();
          updateChart();
        });
      });
    }

    // ---------- Chart ----------
    let chart;
    function getSeries(tf){
      const base = [
        { t:"10.30", v:128 },
        { t:"10.45", v:112 },
        { t:"11.00", v:123 },
        { t:"11.15", v:118 },
        { t:"11.30", v:147 },
        { t:"11.45", v:125 },
        { t:"12.00", v:132 },
        { t:"12.15", v:115 },
        { t:"12.30", v:128 },
        { t:"12.45", v:108 },
        { t:"13.00", v:121 },
      ];
      const mult = (tf==="1s")?0.5:(tf==="1m")?1:(tf==="5m")?1.05:(tf==="15m")?1.1:(tf==="1h")?1.18:(tf==="4h")?1.25:1.3;
      return base.map((p,i)=>({ t:p.t, v: Math.round((p.v*mult + (i%3)*2)*10)/10 }));
    }

    function initChart(){
      const ctx = $("chart").getContext("2d");
      const s = getSeries(state.timeframe);
      const labels = s.map(x=>x.t);
      const data = s.map(x=>x.v);

      const gradient = ctx.createLinearGradient(0, 0, 0, 320);
      gradient.addColorStop(0, "rgba(34,197,94,0.35)");
      gradient.addColorStop(1, "rgba(34,197,94,0.02)");

      chart = new Chart(ctx, {
        type: "line",
        data: {
          labels,
          datasets: [{
            label: "Price",
            data,
            borderColor: "rgba(34,197,94,1)",
            borderWidth: 2,
            fill: true,
            backgroundColor: gradient,
            pointRadius: 0,
            tension: 0.35,
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false },
            tooltip: {
              backgroundColor: "rgba(0,0,0,0.75)",
              borderColor: "rgba(255,255,255,0.10)",
              borderWidth: 1,
              titleColor: "rgba(255,255,255,0.70)",
              bodyColor: "rgba(255,255,255,0.95)",
              displayColors: false,
              callbacks: {
                label: (ctx) => "$" + ctx.parsed.y
              }
            }
          },
          scales: {
            x: {
              grid: { display: false },
              ticks: { color: "rgba(255,255,255,0.45)", font: { size: 12 } },
              border: { color: "rgba(255,255,255,0.08)" }
            },
            y: {
              min: 100,
              max: 150,
              ticks: {
                color: "rgba(255,255,255,0.45)",
                font: { size: 12 },
                callback: (v)=> "$" + v
              },
              grid: { color: "rgba(255,255,255,0.06)" },
              border: { color: "rgba(255,255,255,0.08)" }
            }
          }
        }
      });
    }

    function updateChart(){
      const s = getSeries(state.timeframe);
      chart.data.labels = s.map(x=>x.t);
      chart.data.datasets[0].data = s.map(x=>x.v);
      // badge
      $("chartBadge").textContent = (state.chartMode === "line") ? "Area" : "Candles";
      $("pairBadge").textContent = `${state.selectedAsset}/${state.quote}`;
      chart.update();
    }

    // ---------- Sync header asset area ----------
    function syncAssetHeader(){
      const a = asset();
      $("assetIcon").textContent = a.icon;
      $("assetIcon").className = `grid h-9 w-9 place-items-center rounded-2xl text-sm font-semibold ${a.iconBg}`;
      $("assetName").textContent = a.name;
      $("pairBadge").textContent = `${state.selectedAsset}/${state.quote}`;
      $("amountAsset").textContent = state.selectedAsset;
      $("quoteBtn").textContent = state.quote;
    }

    // ---------- Order Panel Sync ----------
    function renderOrderTabs(){
      const el = $("orderTabs");
      el.innerHTML = orderTabs.map(t=>{
        const active = t === state.orderTab;
        return `
          <button data-ordertab="${t}" class="h-9 rounded-xl px-4 text-sm font-semibold transition ${active ? "bg-white/10 text-white" : "text-white/60 hover:bg-white/5 hover:text-white"}">
            ${t}
          </button>
        `;
      }).join("");
      el.querySelectorAll("button[data-ordertab]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          state.orderTab = btn.dataset.ordertab;
          renderOrderTabs();
        });
      });
    }

    function syncOrderPanel(){
      const c = compute();
      $("pctPill").textContent = `${state.amountPct}%`;
      $("amountRange").value = state.amountPct;

      $("availableLabel").textContent = state.walletConnected ? `${c.available.toFixed(5)} ${state.selectedAsset}` : "‚Äî";
      $("amountLabel").textContent = state.walletConnected ? c.amt.toFixed(5) : "0.00000";

      $("estPrice").textContent = state.walletConnected ? `$${fmt(c.estPrice, 2)}` : "‚Äî";
      $("orderValue").textContent = state.walletConnected ? `$${fmt(c.orderValue, 2)}` : "‚Äî";
      $("slippage").textContent = state.walletConnected ? "Est: 0.00% | Max: 1%" : "‚Äî";
      $("fees").textContent = state.walletConnected ? "Taker: 0% | Maker: 0%" : "‚Äî";

      // buttons enabled/disabled
      const buy = $("buyBtn");
      const sell = $("sellBtn");
      if(state.walletConnected){
        buy.className = "h-11 rounded-2xl font-semibold transition bg-emerald-500/90 text-black hover:bg-emerald-400";
        sell.className = "h-11 rounded-2xl font-semibold transition bg-white/10 text-rose-400 hover:bg-white/15";
      } else {
        buy.className = "h-11 rounded-2xl font-semibold transition bg-white/10 text-white/40 cursor-not-allowed";
        sell.className = "h-11 rounded-2xl font-semibold transition bg-white/10 text-white/40 cursor-not-allowed";
      }

      // wallet button style
      const wbtn = $("walletBtn");
      const wtxt = $("walletBtnText");
      if(state.walletConnected){
        wbtn.className = "mt-1 flex h-11 w-full items-center justify-center gap-2 rounded-2xl font-semibold transition bg-white/10 text-white hover:bg-white/15";
        wtxt.textContent = "Wallet Connected";
      } else {
        wbtn.className = "mt-1 flex h-11 w-full items-center justify-center gap-2 rounded-2xl font-semibold transition bg-emerald-500/90 text-black hover:bg-emerald-400";
        wtxt.textContent = "Connect Wallet to Trade";
      }
    }

    // ---------- Bottom Tabs / Table ----------
    function renderBottomTabs(){
      const el = $("bottomTabs");
      el.innerHTML = bottomTabs.map(t=>{
        const active = t === state.bottomTab;
        return `
          <button data-btab="${t}" class="h-9 rounded-xl px-3 text-xs md:text-sm font-medium transition ${active ? "bg-white/10 text-white" : "text-white/60 hover:bg-white/5 hover:text-white"}">
            ${t}
          </button>
        `;
      }).join("");
      el.querySelectorAll("button[data-btab]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          state.bottomTab = btn.dataset.btab;
          renderBottomTabs();
          syncBottom();
        });
      });
    }

    function syncBottom(){
      const body = $("txBody");
      if(state.bottomTab !== "Transaction"){
        body.innerHTML = `
          <tr>
            <td colspan="7" class="px-4 py-10 text-center text-sm text-white/55">
              <div class="mx-auto max-w-md">
                <div class ‚Äô‚Äô class="text-white font-semibold">${state.bottomTab}</div>
                <div class="mt-1 text-white/45">
                  Panel ini interaktif (tabs). Tinggal hubungkan ke API kamu kalau sudah siap.
                </div>
              </div>
            </td>
          </tr>
        `;
        return;
      }

      body.innerHTML = txRows.map(r=>{
        const isSell = r.type.toLowerCase() === "sell";
        const cls = isSell ? "text-rose-400" : "text-emerald-400";
        return `
          <tr class="border-t border-white/10 text-sm text-white/80 hover:bg-white/5">
            <td class="px-4 py-3 text-white/60">${r.date}</td>
            <td class="px-4 py-3 font-medium ${cls}">${r.type}</td>
            <td class="px-4 py-3 ${cls}">$${r.price.toFixed(4)}</td>
            <td class="px-4 py-3 ${cls}">$${r.usd}</td>
            <td class="px-4 py-3 ${cls}">${r.zec.toFixed(2)}</td>
            <td class="px-4 py-3 ${cls}">${r.pair}</td>
            <td class="px-4 py-3 text-white/55">${r.trader}</td>
          </tr>
        `;
      }).join("");
    }

    // ---------- Market Trades ----------
    function renderMarketTrades(){
      const el = $("marketTrades");
      el.innerHTML = marketTradesData.map(r=>{
        const cls = r.s === "sell" ? "text-rose-400" : "text-emerald-400";
        return `
          <div class="grid grid-cols-3 px-4 py-3 text-sm text-white/80 hover:bg-white/5">
            <div class="${cls}">${fmt(r.p, 2)}</div>
            <div class="text-center text-white/60">${r.a}</div>
            <div class="text-right text-white/55">${r.t}</div>
          </div>
        `;
      }).join("");
    }

    // ---------- Events ----------
    function bindEvents(){
      // Search (Enter) => switch asset by keyword
      $("search").addEventListener("keydown", (e)=>{
        if(e.key === "Enter"){
          const v = (e.target.value || "").trim().toLowerCase();
          const found = assets.find(a => a.key.toLowerCase() === v || a.name.toLowerCase().includes(v));
          if(found){
            state.selectedAsset = found.key;
            renderAssets();
            syncAssetHeader();
            syncOrderPanel();
            syncBottom();
            updateChart();
          }
        }
      });

      // Asset switch button cycles
      $("assetSwitch").addEventListener("click", ()=>{
        const idx = assets.findIndex(a => a.key === state.selectedAsset);
        state.selectedAsset = assets[(idx + 1) % assets.length].key;
        renderAssets();
        syncAssetHeader();
        syncOrderPanel();
        updateChart();
      });

      // Quote toggle
      function toggleQuote(){
        state.quote = (state.quote === "USD") ? "USDT" : "USD";
        $("quoteBtn").textContent = state.quote;
        renderAssets();
        syncAssetHeader();
        updateChart();
      }
      $("quoteBtn").addEventListener("click", toggleQuote);

      // Chart mode toggles
      $("modeLine").addEventListener("click", ()=>{
        state.chartMode = "line";
        $("modeLine").className = "rounded-xl p-2 bg-white/10 text-white";
        $("modeCandle").className = "rounded-xl p-2 text-white/60 hover:bg-white/5 hover:text-white";
        updateChart();
      });
      $("modeCandle").addEventListener("click", ()=>{
        state.chartMode = "candle";
        $("modeCandle").className = "rounded-xl p-2 bg-white/10 text-white";
        $("modeLine").className = "rounded-xl p-2 text-white/60 hover:bg-white/5 hover:text-white";
        updateChart();
      });

      // Chart focus (simple: expand grid)
      $("chartFocus").addEventListener("click", ()=>{
        state.focus = !state.focus;
        const chartCard = $("chartCard");
        const bottomCard = $("bottomCard");
        if(state.focus){
          chartCard.classList.add("lg:col-span-2");
          bottomCard.classList.add("lg:col-span-2");
          $("chartFocus").textContent = "üóó";
        } else {
          chartCard.classList.remove("lg:col-span-2");
          bottomCard.classList.remove("lg:col-span-2");
          $("chartFocus").textContent = "‚õ∂";
        }
      });

      // Amount slider
      $("amountRange").addEventListener("input", (e)=>{
        state.amountPct = Number(e.target.value);
        syncOrderPanel();
      });

      // Wallet connect
      $("walletBtn").addEventListener("click", ()=>{
        state.walletConnected = !state.walletConnected;
        syncOrderPanel();
      });

      // Buy / Sell actions
      $("buyBtn").addEventListener("click", ()=>{
        if(!state.walletConnected) return;
        const c = compute();
        alert(`Placed ${state.orderTab} Buy/Long: ${c.amt} ${state.selectedAsset}`);
      });
      $("sellBtn").addEventListener("click", ()=>{
        if(!state.walletConnected) return;
        const c = compute();
        alert(`Placed ${state.orderTab} Sell/Short: ${c.amt} ${state.selectedAsset}`);
      });

      // Quick tools panel
      $("quickToolsBtn").addEventListener("click", ()=>{
        $("quickToolsPanel").classList.toggle("hidden");
      });
      $("quickToolsClose").addEventListener("click", ()=>{
        $("quickToolsPanel").classList.add("hidden");
      });
      document.querySelectorAll(".qtBtn").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          state.amountPct = Number(btn.dataset.setpct);
          syncOrderPanel();
        });
      });

      // Bottom filter just toggles quick tools too (like screenshot style)
      $("bottomFilterBtn").addEventListener("click", ()=>{
        $("quickToolsPanel").classList.toggle("hidden");
      });

      // View settings panel
      $("viewSettingsBtn").addEventListener("click", ()=>{
        $("viewSettingsPanel").classList.toggle("hidden");
      });
      $("viewSettingsClose").addEventListener("click", ()=>{
        $("viewSettingsPanel").classList.add("hidden");
      });
      $("toggleChartMode").addEventListener("click", ()=>{
        state.chartMode = (state.chartMode === "line") ? "candle" : "line";
        if(state.chartMode === "line"){
          $("modeLine").click();
        } else {
          $("modeCandle").click();
        }
      });
      $("toggleQuote").addEventListener("click", ()=>{
        $("quoteBtn").click();
      });
    }

    // ---------- Boot ----------
    function boot(){
      renderNav();
      renderTimeframes();
      renderOrderTabs();
      renderBottomTabs();
      renderMarketTrades();

      renderAssets();
      syncAssetHeader();
      syncOrderPanel();
      syncBottom();

      initChart();
      updateChart();

      bindEvents();
    }

    boot();
  </script>
</body>
</html>
